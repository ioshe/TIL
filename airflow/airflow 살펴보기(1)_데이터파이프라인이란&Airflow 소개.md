# airflow 살펴보기(1)

1. 데이터파이프라인이란?
    - 만약 날씨를 알려주는 프로젝트를 진행한다고 하였을 때 작업의 단계를 3가지로 나눌 수 있다.
        1. 다른 시스템의 날씨 API를 통해 일기예보 데이터를 가져온다. **(추출)**
        2. 서비스 목적에 맞도록 데이터를 정제하거나 변환(온도를 화씨에서 섭씨로)**(변환)**
        3. 변환된 데이터를 날씨 대시보드로 전송**(적재)**
    - 이렇게 파이프라인은 비교적 간단하지만 서로 다른 태스크로 구성되어 있다. 그리고 각 태스크는 정해진 순서대로 진행되어야 한다.
    1. 태스크task 간의 의존성을 명확하게 확인하는 방법 중 하나는, 데이터 파이프라인을 그래프로 표현하는 것이다. 일반적으로 그래프는 방향성 비순환 그래프(Directed Acyclic Graph, DAG)으로 표현합니다. 만약 방향성 그래프로 표현하게 된다면 태스크 간의 순환 실행을 일으킬 수도 있어 순환 의존성이 문제가 발생한다.
    2. 그래프 기반 표현의 또 다른 특성은 전체 작업을 하나의 모놀리식monlithic(단일) 스크립트 또는 프로세스로 구성되는 것이 아니라 파이프라인을 작은 점진적인 태스크로 명확하게 분리할 수 있다는 것이다. 이는 파이프라인의 중간 태스크가 실패하면 전체 스크립트를 재실행하는 것을 막아주기 떄문에 효율적이다.

1. Airflow 소개
    - 유연한 파이썬 프레임워크를 사용해 쉽게 Data piepline을 구축할 수 있게 한다.
    - 다양한 분산 시스템에서 발생하는 작업을 조율한다.
    - Airflow는 직접적으로 데이터 처리 작업을 수행하지는 않지만, 데이터 처리를 위한 다양한 구성요소들을 조정한다.
    1. 파이썬 코드로 유연한 파이프라인 정의
        - Airflow는 파이썬 스크립트로 DAG의 구조를 설명하고 구성한다.
        - 일반적으로 각 DAG 파일은 서로 다른 태스크와 해당 **의존성을 기술하는 하나**의 DAG에 대해 정의한다. 또한 AIrflow가 실행되는 시기와 주기를 정의한다.
    2. 파이프라인 스케줄링 및 실행
        - Airflow 스케줄러 - DAG를 분석하고 현재 시에서 DAG의 스케줄이 지난 경우Airflow 워커에 DAG의 태스크를 예약한다.
        - Airflow 워커 - 예약된 태스크를 선택하고 실행한다.
        - Airflow 웹서버 - 스케줄러에서 분석한 DAG를 시각화 하고 DAG 실행과 결과를 확인할 수 있는 주요 인터페이스를 제공한다.
    3. 모니터링과 실패 처리
        - AIrflow는 개별 DAG의 태스크와 의존성에 대한 그래프 뷰Graph View 화면을 제공한다. 이는 DAG의 구조와 개별 dAG에 대한 실행 결과를 확인하는데 유용하다.
        - 그래프 뷰 이외에도 특정DAG에 대한 모든 실행 현황과 기록을 트리tree를 통해 확인할 수 있다.이를 통해 DAG가 시간 순으로 어떻게 수행되었는지 빠르게 확인 할 수 있으며 실패한 태스크에 대해서도 빠르게 확인할 수 있다.
    4. 점진적 로딩 및 백필
        - Airflow는 DAG에 정의된 특정 시점에 트리거할 수 있을 뿐만 아니라, 각 주기별로 DAG를 실행할 수 있다.
        - 점진적인 파이프라인에서 각 DAG는 매번 전체 데이터 세트를 다시 처리할 필요 없이 해당 시간 블록에 대한 데이터만 처리한다. 이는 대규모 데이터 세트를 처리해야 할 경우에 기존 결과에 대한 태스크 전체를 다시 수행하는 것을 방지하여 많은 시간과 비용을 절감할 수 있다.
        - 백필을 통해 과거 특정 기간에 대해 DAG를 실행해 새로운 데이터 세트를 손쉽게 생성 할 수 있다.