# Servlet(2)_서블릿구현_요청응답정보

## 2. 서블릿 구현 및 실행

### 2-1. 서블릿 클래스 간의 관계

- **HttpServlet** : 웹상에서 클라이언트 요청이 있을 때 해당 서블릿을 실행하는 모든 조건이 포함되어 있다. 서블릿을 구현할 때 반드시 상속받아야 한다.

### 2-2. 서블릿 실행 순서

- **JavaSE**은 개발자가 `main()` 메소드 안에 구현한 순서대로 실행된다. 하지만 JavaEE 기반 프로그램은 실행의 흐름을 개발자가 제어하는 것이 아니라 컨테이너가 제어한다.
    
    <img src = "../data/Servlet(2)_Servlet의 실행순서.png">
    
- 이와 같이 개발자가 아닌 제 3자가 프로그램의 실행 흐름을 제어하는 것을 **`Ioc(Inversion of Control)`** 제어의 역전 이라고 한다.
    - Sevlet 추상 메서드의 역할
        1. **init**
        - 서블릿을 생성하고 초기화한다. 
        - 웹 컨테이너가 서블릿 클래스의 인스턴스를 생성할 때 이 메서드를 호출하며, 초기화에 필요한 작업을 여기에 작성한다. 
        - 서블릿이 클라이언트 요청을 처리하기 전에 필요한 준비 작업을 이 메서드에서 처리한다.
        2. **service**
        - 클라이언트의 요청이 있을 때마다 이 메서드가 호출된다. 
        - 요청에 대한 실질적인 처리를 수행하는 부분으로, 서블릿의 주요 작업이 이 메서드에 구현된다. 
        - 클라이언트의 요청 유형(GET, POST 등)에 맞게 **`doGet()`**, **`doPost()`** 등의 메서드를 호출해 요청을 처리하고 응답을 생성한다.
        3. **destory**
        - 서블릿의 생명 주기 중 종료 단계를 담당한다. 
        - 서블릿 컨테이너가 종료되거나 서블릿이 더 이상 필요하지 않을 때 이 메서드가 호출된다. 
        - 서블릿의 마무리 작업은 이 메서드에서 이루어진다.
        4. **getServletConfig**
        - 서블릿 설정에 관한 정보를 담고 있는 `ServletConfig` 객체를 반환한다. 
        - 이 객체에는 서블릿의 이름, 초기 매개변수 값, 서블릿 환경 정보 등이 포함되어 있다.
        5. **getServletInfo**
        - 서블릿을 작성한 사용자에 대한 정보, 서블릿의 버전과 저작권 정보 등을 담은 문자열을 반환한다.
        - 이 메서드를 통해 서블릿에 대한 추가적인 정보를 얻을 수 있다.
- **콜백메서드**(callback method) 어떤 객체에서 어떤 상황이 발생하면 컨테이너가 자동 호출하여 실행되는 메소드이다.
    - **init()** : 클라이언트로부터 최초로 서블릿 요청이 있을 때 실행
    - **service()** : 클라이언트로부터 요청이 있을 때마다 실행
    - **destory()** : 서블릿 객체가 메모리에서 삭제될 때 실행
    

### 2-3. 서블릿 실행

- **`WEB-INF`** 는 웹서버가 사용하는 중요한 디렉터리이다. 클라이언트는 곧 바로 이에 접근 할 수 없으며 서버는 **`@WebServlet`** 을 통해 접근시켜준다.
- **service 함수의 동작 :** 서블릿이 실핼될 때 service()메서드는 자동으로 실행된다. HttpServlet클래스에는 service()메소드가 2개이다.
    
    ```java
    protected void service(HttpServletRequest req, HttpServletResponse resp)
    public void service(ServletRequest req, ServletResponse res)
    ```
    
- 이 중 서블릿 요청이 있을 때마다 실행되는 메소드는 2번 형태의 service()이다. 하지만 2번 service()는 단순히 1번 형태의 service()만 호출한다.
- 또한 1번 service()메소드는 클라이언트의 실행 요청에 따라 서로 다른 메소드를 호출하도록 구현되었다. 실행 요청의 정보는 헤더와 몸체로 구성된다.
- 요청정보 헤더의 첫 줄에는 3개의 정보가 들어간다. 그 중 첫 번째 단어가 요청방식에 대한 정보이다. 요청방식은 GET, POST, PUT, DELETE가 있다. 1번 형태의 service()는 요청방식 정보를 추출한 후 추출된 요청방식 정보에 따라 서로 다른 메소드를 호출하도록 구현되었다.

## 3. 요청정보와 응답정보

### 3.1 객체 생성 및 삭제

- 클라이언트가 웹 브라우저에서 서비스를 요청한다. 이 때 **HTTP 프로토콜** 기반으로 요청정보가 만들어져 웹서버에 전달된다.
- 웹서버는 클라이언트로부터 전달받은 요청정보의 URI를 살펴보고, 서블릿이라면 **서블릿 컨테이너**에 처리를 넘긴다.
- 서블릿 컨테이너는 요청 받은 서블릿 클래스 파일을 찾아서 실행한다.
    - 실행의 첫 순서로는 최초의 요청인지 파악 후 최초의 요청이면 메모리에 로딩 후 객체를 생성하고 `init()` 메서드를 호출한다.
    - `init()` 메소드 실행이 끝난 다음에는 최초의 요청이든 그렇지 않든 서블릿 실행 요청이 들어올 때마다 실행되는 작업으로 서블릿 컨테이너는 `HttpServletRequest`와 `HttpServletResponse` 객체를 생성한다. `HttpServletRequest` 객체는 클라이언트로부터 요청받은 정보를 처리할 목적으로 생성하고, `HttpServletResponse` 객체는 클라이언트에게 보내는 응답정보를 처리할 목적으로 생성한다.
- `service()` 메소드를 호출한다. 이 때 앞에서 생성한 `HttpServletRequest`와 `HttpServletResponse` 객체의 주소를 인자로 넘긴다. `service()`메소드에서는 인자로 받은 두 객체를 사용하여 프로그램을 구현한다.
- `service()` 메소드가 완료되면 클라이언트에게 응답을 보내고 서버에서 실행되는 프로그램은 완료된다. **이 때, `HttpServletRequest`와 `HttpServletResponse` 객체는 소멸한다.**

### 3.2 응답정보처리 - HttpServletResponse

- 서비스를 요청한 클라이언트에게 응답하기 위한 기능을 처리할 때 `javax.servlet` 패키지의 **`ServletResponse` 인터페이스**를 사용한다. 이는 **네트워크 환경에서 필요한 응답 관련 메소드들을 정의**한다. (이 인터페이스를 이용하여 클라이언트의 요청에 응답하기 위한 출력스트림을 추출하거나 버퍼의 크기를 설정하고, 응답할 내용의 타입과 문자셋을 설정한다.)
- `HttpServletResponse` 인터페이스는 `ServletResponse` 인터페이스를 상속한다. 따라서 HTTP 프로토콜 통신 기반의 응답 관련 메소드들도 확장하여 포함한다.

### 3.3 요청정보처리 - HttpServletRequest

- 클라이언트는 서버에게 수행을 요청할 때 일정한 형식의 다양한 정보를 서버로 전달한다.
- 이런 정보는 `HttpServletRequest` 인터페이스의 `getXXX()` 메소드를 통해 추출할 수 있고, `HttpServletRequest`는 `service()`나 `doGet()`또는 `doPost()` 메소드의 첫 번째 인자로 전달된다.
